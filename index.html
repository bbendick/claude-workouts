<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://api.github.com; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Gym Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2rem;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .setup-screen, .workout-selection, .workout-screen {
            display: none;
        }
        
        .setup-screen.active, .workout-selection.active, .workout-screen.active {
            display: block;
        }
        
        .setup-form {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #333;
            color: white;
            font-size: 16px;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .last-workout {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }
        
        .workout-option {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .workout-option:hover {
            border-color: #4CAF50;
        }
        
        .workout-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .exercise-count {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .current-exercise {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .exercise-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        .exercise-info {
            margin-bottom: 15px;
            color: #ccc;
        }
        
        .sets-progress {
            margin-bottom: 20px;
        }
        
        .set-info {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .rep-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .rep-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #4CAF50;
            color: white;
            border: none;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .rep-button:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .rep-button:disabled {
            background: #666;
            transform: none;
        }
        
        .rep-count {
            font-size: 2rem;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        
        .timer {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .timer-label {
            color: #ccc;
            font-size: 1.1rem;
        }
        
        .exercise-timer {
            color: #ff9800;
        }
        
        .rest-timer {
            color: #4CAF50;
        }
        
        .next-set-btn, .next-exercise-btn, .finish-btn {
            background: #2196F3;
            margin-top: 10px;
        }
        
        .next-set-btn:hover, .next-exercise-btn:hover, .finish-btn:hover {
            background: #1976D2;
        }
        
        .error {
            background: #f44336;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .success {
            background: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .loading {
            text-align: center;
            color: #ccc;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Gym Tracker</h1>
        </div>
        
        <!-- GitHub Setup Screen -->
        <div class="setup-screen active">
            <div class="setup-form">
                <h2>GitHub Setup</h2>
                <p style="color: #ccc; margin-bottom: 20px;">
                    Connect to your GitHub repository to store workout data.
                </p>
                
                <div class="form-group">
                    <label for="github-username">GitHub Username:</label>
                    <input type="text" id="github-username" placeholder="your-username">
                </div>
                
                <div class="form-group">
                    <label for="github-repo">Repository Name:</label>
                    <input type="text" id="github-repo" placeholder="gym-tracker">
                </div>
                
                <div class="form-group">
                    <label for="github-token">Personal Access Token:</label>
                    <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
                </div>
                
                <button class="btn" id="connect-btn">Connect to GitHub</button>
                
                <div id="setup-status"></div>
            </div>
        </div>
        
        <!-- Workout Selection Screen -->
        <div class="workout-selection">
            <div class="last-workout" id="last-workout-info">
                <strong>Last Workout:</strong> <span id="last-workout-text">None recorded</span>
            </div>
            
            <h2 style="margin-bottom: 20px;">Select Today's Workout</h2>
            <div id="workout-options"></div>
            
            <button class="btn" onclick="showSetup()" style="background: #666; margin-top: 20px;">
                ‚öôÔ∏è GitHub Settings
            </button>
        </div>
        
        <!-- Workout Screen -->
        <div class="workout-screen">
            <div class="current-exercise">
                <div class="exercise-name" id="current-exercise-name"></div>
                <div class="exercise-info" id="current-exercise-info"></div>
                
                <div class="sets-progress">
                    <div class="set-info" id="set-info"></div>
                </div>
                
                <div class="rep-counter" id="rep-counter">
                    <button class="rep-button" onclick="completeRep()">‚úì</button>
                    <div class="rep-count" id="rep-count">0</div>
                    <button class="rep-button" onclick="undoRep()">‚Ü∂</button>
                </div>
                
                <div class="timer" id="timer-section" style="display: none;">
                    <div class="timer-display" id="timer-display">00:00</div>
                    <div class="timer-label" id="timer-label">Rest Timer</div>
                </div>
                
                <button class="btn next-set-btn" id="next-set-btn" onclick="nextSet()" style="display: none;">
                    Next Set
                </button>
                
                <button class="btn next-exercise-btn" id="next-exercise-btn" onclick="nextExercise()" style="display: none;">
                    Next Exercise
                </button>
                
                <button class="btn finish-btn" id="finish-btn" onclick="finishWorkout()" style="display: none;">
                    Finish Workout
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let workoutData = null;
        let currentSession = null;
        let currentExerciseIndex = 0;
        let currentSet = 0;
        let currentReps = 0;
        let timer = null;
        let timerSeconds = 0;
        let isExerciseTimer = false;
        
        // GitHub configuration
        let githubConfig = {
            username: '',
            repo: '',
            token: ''
        };
        
        // Initialize app
        window.onload = function() {
            // Add event listener for connect button
            document.getElementById('connect-btn').addEventListener('click', setupGitHub);
            
            loadGitHubConfig();
        };
        
        function loadGitHubConfig() {
            const saved = JSON.parse(sessionStorage.getItem('githubConfig') || '{}');
            
            if (saved.username && saved.repo && saved.token) {
                githubConfig = saved;
                loadWorkoutData();
            } else {
                showSetup();
            }
        }
        
        async function setupGitHub() {
            console.log('setupGitHub called');
            
            const username = document.getElementById('github-username').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            const token = document.getElementById('github-token').value.trim();
            
            console.log('Username:', username);
            console.log('Repo:', repo);
            console.log('Token provided:', token ? 'yes' : 'no');
            
            if (!username || !repo || !token) {
                console.log('Missing fields - stopping');
                showStatus('setup-status', 'Please fill in all fields', 'error');
                return;
            }
            
            console.log('All fields provided, proceeding...');
            
            githubConfig = { username, repo, token };
            sessionStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            
            console.log('githubConfig username:', githubConfig.username);
            console.log('githubConfig repo:', githubConfig.repo);
            console.log('githubConfig token length:', githubConfig.token.length);
            
            showStatus('setup-status', 'Testing connection...', 'loading');
            
            // Simplified test - just try to load workout data directly
            try {
                console.log('About to call loadWorkoutData...');
                console.log('Current githubConfig username:', githubConfig.username);
                console.log('Current githubConfig repo:', githubConfig.repo);
                await loadWorkoutData();
                console.log('loadWorkoutData completed successfully');
                showStatus('setup-status', 'Connected successfully!', 'success');
                setTimeout(() => {
                    showWorkoutSelection();
                }, 1000);
            } catch (error) {
                console.error('loadWorkoutData failed:', error);
                console.error('Error details:', error.message);
                console.error('Error stack:', error.stack);
                showStatus('setup-status', `Connection failed: ${error.message}`, 'error');
            }
        }
        
        function loadGitHubConfig() {
            const saved = JSON.parse(sessionStorage.getItem('githubConfig') || '{}');
            
            if (saved.username && saved.repo && saved.token) {
                githubConfig = saved;
                loadWorkoutData();
            } else {
                showSetup();
            }
        }
        
        function showSetup() {
            document.querySelector('.setup-screen').classList.add('active');
            document.querySelector('.workout-selection').classList.remove('active');
            document.querySelector('.workout-screen').classList.remove('active');
        }
        
        function showWorkoutSelection() {
            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.workout-selection').classList.add('active');
            document.querySelector('.workout-screen').classList.remove('active');
        }
        
        function showWorkoutScreen() {
            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.workout-selection').classList.remove('active');
            document.querySelector('.workout-screen').classList.add('active');
        }
        
        async function setupGitHub() {
            console.log('setupGitHub called');
            
            const username = document.getElementById('github-username').value.trim();
            const repo = document.getElementById('github-repo').value.trim();
            const token = document.getElementById('github-token').value.trim();
            
            console.log('Username:', username);
            console.log('Repo:', repo);
            console.log('Token provided:', token ? 'yes' : 'no');
            
            if (!username || !repo || !token) {
                console.log('Missing fields - stopping');
                showStatus('setup-status', 'Please fill in all fields', 'error');
                return;
            }
            
            console.log('All fields provided, proceeding...');
            
            githubConfig = { username, repo, token };
            sessionStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            
            console.log('githubConfig username:', githubConfig.username);
            console.log('githubConfig repo:', githubConfig.repo);
            console.log('githubConfig token length:', githubConfig.token.length);
            
            showStatus('setup-status', 'Testing connection...', 'loading');
            
            // Simplified test - just try to load workout data directly
            try {
                console.log('About to call loadWorkoutData...');
                console.log('Current githubConfig username:', githubConfig.username);
                console.log('Current githubConfig repo:', githubConfig.repo);
                await loadWorkoutData();
                console.log('loadWorkoutData completed successfully');
                showStatus('setup-status', 'Connected successfully!', 'success');
                setTimeout(() => {
                    showWorkoutSelection();
                }, 1000);
            } catch (error) {
                console.error('loadWorkoutData failed:', error);
                console.error('Error details:', error.message);
                console.error('Error stack:', error.stack);
                showStatus('setup-status', `Connection failed: ${error.message}`, 'error');
            }
        }
        
        async function loadWorkoutData() {
            console.log('=== ENTERING loadWorkoutData ===');
            console.log('githubConfig available:', typeof githubConfig);
            console.log('githubConfig.username:', githubConfig.username);
            console.log('githubConfig.repo:', githubConfig.repo);
            
            try {
                console.log('Starting loadWorkoutData...');
                const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/workouts.json`;
                console.log('Fetching URL:', url);
                console.log('Using token starting with:', githubConfig.token.substring(0, 10) + '...');
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                console.log('Fetch completed');
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('Error response body:', errorText);
                    
                    if (response.status === 404) {
                        console.log('File not found, creating initial structure...');
                        // File doesn't exist, create initial structure
                        workoutData = {
                            workouts: {
                                "upper-body": {
                                    "name": "Upper Body Emphasis",
                                    "exercises": [
                                        {"name": "Chest Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Seated Row (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Shoulder Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Leg Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Plank", "sets": 2, "targetReps": 1, "duration": 30, "restTime": 60},
                                        {"name": "Standing Cable Rotations", "sets": 2, "targetReps": 10, "currentWeight": 0, "restTime": 60}
                                    ]
                                },
                                "lower-body": {
                                    "name": "Lower Body Emphasis",
                                    "exercises": [
                                        {"name": "Leg Extensions (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Leg Curls (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Lat Pulldown (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Cable Tricep Pushdown", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Seated Back Extension", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Wall Sit", "sets": 2, "targetReps": 1, "duration": 30, "restTime": 60}
                                    ]
                                },
                                "balance": {
                                    "name": "Full Body Balance",
                                    "exercises": [
                                        {"name": "Chest Fly (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Cable Face Pull", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Lateral Raise", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Seated Leg Adduction/Abduction", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                                        {"name": "Standing Cable Rotations", "sets": 2, "targetReps": 10, "currentWeight": 0, "restTime": 60},
                                        {"name": "Assisted Pull-ups", "sets": 2, "targetReps": 8, "currentWeight": 0, "restTime": 60}
                                    ]
                                }
                            },
                            sessions: []
                        };
                        await saveWorkoutData();
                    } else if (response.status === 401) {
                        throw new Error(`Authentication failed. Please check your Personal Access Token has 'repo' permissions.`);
                    } else if (response.status === 403) {
                        throw new Error(`Access forbidden. Check that the repository exists and your token has access to it.`);
                    } else {
                        let errorDetails = '';
                        try {
                            const errorJson = JSON.parse(errorText);
                            errorDetails = errorJson.message || errorText;
                        } catch (e) {
                            errorDetails = errorText || `HTTP ${response.status}`;
                        }
                        throw new Error(`GitHub API error (${response.status}): ${errorDetails}`);
                    }
                } else {
                    console.log('Successfully got file, parsing...');
                    const data = await response.json();
                    workoutData = JSON.parse(atob(data.content));
                    console.log('Workout data loaded successfully');
                }
                
                displayWorkoutOptions();
                displayLastWorkout();
                showWorkoutSelection();
                
            } catch (error) {
                console.error('Full error:', error);
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error(`Network error: Unable to connect to GitHub. Check your internet connection and make sure you can access github.com`);
                } else {
                    throw new Error(`Failed to load workout data: ${error.message}`);
                }
            }
        }
        
        async function saveWorkoutData() {
            // Save to localStorage
            localStorage.setItem('workoutData', JSON.stringify(workoutData));
            console.log('Data saved to localStorage');
        }
        
        function addExportButton() {
            if (!document.getElementById('export-btn')) {
                const exportBtn = document.createElement('button');
                exportBtn.id = 'export-btn';
                exportBtn.className = 'btn';
                exportBtn.style.background = '#ff9800';
                exportBtn.style.marginTop = '20px';
                exportBtn.textContent = 'üì§ Export Data';
                exportBtn.onclick = exportData;
                
                const settingsBtn = document.querySelector('.workout-selection button[onclick="showSetup()"]');
                settingsBtn.parentNode.insertBefore(exportBtn, settingsBtn);
            }
        }
        
        function exportData() {
            const dataStr = JSON.stringify(workoutData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `workout-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        function displayWorkoutOptions() {
            const container = document.getElementById('workout-options');
            container.innerHTML = '';
            
            Object.keys(workoutData.workouts).forEach(workoutId => {
                const workout = workoutData.workouts[workoutId];
                const div = document.createElement('div');
                div.className = 'workout-option';
                div.onclick = () => startWorkout(workoutId);
                
                div.innerHTML = `
                    <div class="workout-title">${workout.name}</div>
                    <div class="exercise-count">${workout.exercises.length} exercises</div>
                `;
                
                container.appendChild(div);
            });
        }
        
        function displayLastWorkout() {
            const lastWorkoutText = document.getElementById('last-workout-text');
            
            if (workoutData.sessions.length === 0) {
                lastWorkoutText.textContent = 'None recorded';
                return;
            }
            
            const lastSession = workoutData.sessions[workoutData.sessions.length - 1];
            const date = new Date(lastSession.date);
            const workoutName = workoutData.workouts[lastSession.workoutId]?.name || 'Unknown workout';
            
            lastWorkoutText.textContent = `${workoutName} on ${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        }
        
        function startWorkout(workoutId) {
            currentSession = {
                date: new Date().toISOString(),
                workoutId: workoutId,
                exercises: []
            };
            
            currentExerciseIndex = 0;
            currentSet = 0;
            currentReps = 0;
            
            showWorkoutScreen();
            displayCurrentExercise();
        }
        
        function displayCurrentExercise() {
            const workout = workoutData.workouts[currentSession.workoutId];
            const exercise = workout.exercises[currentExerciseIndex];
            
            document.getElementById('current-exercise-name').textContent = exercise.name;
            
            let info = `Set ${currentSet + 1} of ${exercise.sets}`;
            if (exercise.currentWeight > 0) {
                info += ` ‚Ä¢ ${exercise.currentWeight} units`;
            }
            if (exercise.duration) {
                info += ` ‚Ä¢ ${exercise.duration}s hold`;
            } else {
                info += ` ‚Ä¢ Target: ${exercise.targetReps} reps`;
            }
            
            document.getElementById('current-exercise-info').textContent = info;
            document.getElementById('set-info').textContent = `Reps completed: ${currentReps}`;
            document.getElementById('rep-count').textContent = currentReps;
            
            // Hide all control buttons initially
            document.getElementById('next-set-btn').style.display = 'none';
            document.getElementById('next-exercise-btn').style.display = 'none';
            document.getElementById('finish-btn').style.display = 'none';
            
            // Show rep counter
            document.getElementById('rep-counter').style.display = 'flex';
            
            stopTimer();
        }
        
        function completeRep() {
            const workout = workoutData.workouts[currentSession.workoutId];
            const exercise = workout.exercises[currentExerciseIndex];
            
            currentReps++;
            document.getElementById('rep-count').textContent = currentReps;
            document.getElementById('set-info').textContent = `Reps completed: ${currentReps}`;
            
            // If this is a duration-based exercise, start the exercise timer
            if (exercise.duration && currentReps <= exercise.targetReps) {
                startExerciseTimer(exercise.duration);
            } else {
                // Start rest timer for regular exercises or after duration exercise completes
                startRestTimer(exercise.restTime);
            }
            
            // Check if set is complete
            if (currentReps >= exercise.targetReps) {
                document.getElementById('rep-counter').style.display = 'none';
                
                if (currentSet < exercise.sets - 1) {
                    document.getElementById('next-set-btn').style.display = 'block';
                } else if (currentExerciseIndex < workout.exercises.length - 1) {
                    document.getElementById('next-exercise-btn').style.display = 'block';
                } else {
                    document.getElementById('finish-btn').style.display = 'block';
                }
            }
        }
        
        function undoRep() {
            if (currentReps > 0) {
                currentReps--;
                document.getElementById('rep-count').textContent = currentReps;
                document.getElementById('set-info').textContent = `Reps completed: ${currentReps}`;
                
                // Show rep counter again if it was hidden
                document.getElementById('rep-counter').style.display = 'flex';
                
                // Hide control buttons
                document.getElementById('next-set-btn').style.display = 'none';
                document.getElementById('next-exercise-btn').style.display = 'none';
                document.getElementById('finish-btn').style.display = 'none';
                
                stopTimer();
            }
        }
        
        function nextSet() {
            // Record the completed set
            recordSet();
            
            currentSet++;
            currentReps = 0;
            displayCurrentExercise();
        }
        
        function nextExercise() {
            // Record the completed set
            recordSet();
            
            currentExerciseIndex++;
            currentSet = 0;
            currentReps = 0;
            displayCurrentExercise();
        }
        
        function recordSet() {
            const workout = workoutData.workouts[currentSession.workoutId];
            const exercise = workout.exercises[currentExerciseIndex];
            
            // Find or create exercise record in current session
            let exerciseRecord = currentSession.exercises.find(e => e.name === exercise.name);
            if (!exerciseRecord) {
                exerciseRecord = {
                    name: exercise.name,
                    sets: []
                };
                currentSession.exercises.push(exerciseRecord);
            }
            
            // Add the completed set
            exerciseRecord.sets.push({
                reps: currentReps,
                weight: exercise.currentWeight || 0
            });
        }
        
        async function finishWorkout() {
            // Record the final set
            recordSet();
            
            // Save session to workout data
            workoutData.sessions.push(currentSession);
            
            // Save to GitHub
            await saveWorkoutData();
            
            // Return to workout selection
            showWorkoutSelection();
            displayLastWorkout();
            
            alert('Workout completed and saved!');
        }
        
        function startRestTimer(seconds) {
            startTimer(seconds, false, 'Rest Timer');
        }
        
        function startExerciseTimer(seconds) {
            startTimer(seconds, true, 'Exercise Timer');
        }
        
        function startTimer(seconds, isExercise, label) {
            stopTimer();
            
            timerSeconds = seconds;
            isExerciseTimer = isExercise;
            
            const timerSection = document.getElementById('timer-section');
            const timerDisplay = document.getElementById('timer-display');
            const timerLabel = document.getElementById('timer-label');
            
            timerLabel.textContent = label;
            timerSection.style.display = 'block';
            
            if (isExercise) {
                timerSection.className = 'timer exercise-timer';
            } else {
                timerSection.className = 'timer rest-timer';
            }
            
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    if (isExercise) {
                        // Exercise timer finished, mark rep as complete and start rest timer
                        const workout = workoutData.workouts[currentSession.workoutId];
                        const exercise = workout.exercises[currentExerciseIndex];
                        startRestTimer(exercise.restTime);
                    }
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timer-display').textContent = display;
        }
        
        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
            document.getElementById('timer-section').style.display = 'none';
        }
        
        function showOfflineOption() {
            document.getElementById('offline-option').style.display = 'block';
        }
        
        function useOfflineMode() {
            // Initialize with default workout data
            workoutData = {
                "workouts": {
                    "day1-upper": {
                        "name": "Day 1: Full Body Emphasis on Upper Body",
                        "exercises": [
                            {"name": "Chest Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Seated Row (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Shoulder Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Leg Press (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Plank", "sets": 2, "targetReps": 1, "duration": 30, "restTime": 60},
                            {"name": "Standing Cable Rotations", "sets": 2, "targetReps": 10, "currentWeight": 0, "restTime": 60}
                        ]
                    },
                    "day2-lower": {
                        "name": "Day 2: Full Body Emphasis on Lower Body",
                        "exercises": [
                            {"name": "Leg Extensions (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Leg Curls (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Lat Pulldown (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Cable Tricep Pushdown", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Seated Back Extension", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Wall Sit", "sets": 2, "targetReps": 1, "duration": 30, "restTime": 60}
                        ]
                    },
                    "day3-balance": {
                        "name": "Day 3: Full Body Balance",
                        "exercises": [
                            {"name": "Chest Fly (machine)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Cable Face Pull", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Lateral Raise (machine or light dumbbells)", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Seated Leg Adduction/Abduction", "sets": 2, "targetReps": 12, "currentWeight": 0, "restTime": 60},
                            {"name": "Standing Cable Rotations", "sets": 2, "targetReps": 10, "currentWeight": 0, "restTime": 60},
                            {"name": "Assisted Pull-ups (machine)", "sets": 2, "targetReps": 8, "currentWeight": 0, "restTime": 60}
                        ]
                    }
                },
                "sessions": []
            };
            
            // Mark as offline mode
            sessionStorage.setItem('offlineMode', 'true');
            
            displayWorkoutOptions();
            displayLastWorkout();
            showWorkoutSelection();
            
            // Add export button to workout selection
            addExportButton();
        }
        
        function addExportButton() {
            if (!document.getElementById('export-btn')) {
                const exportBtn = document.createElement('button');
                exportBtn.id = 'export-btn';
                exportBtn.className = 'btn';
                exportBtn.style.background = '#ff9800';
                exportBtn.style.marginTop = '20px';
                exportBtn.textContent = 'üì§ Export Data';
                exportBtn.onclick = exportData;
                
                document.querySelector('.workout-selection').appendChild(exportBtn);
            }
        }
        
        function exportData() {
            const dataStr = JSON.stringify(workoutData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `workout-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>